{"ast":null,"code":"import _taggedTemplateLiteral from \"@babel/runtime-corejs2/helpers/esm/taggedTemplateLiteral\";\nimport _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _Date$now from \"@babel/runtime-corejs2/core-js/date/now\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime-corejs2/helpers/esm/slicedToArray\";\nvar __jsx = React.createElement;\n\nfunction _templateObject14() {\n  var data = _taggedTemplateLiteral([\"\\n    display: block;\\n    width: 400px;\\n    height: 80px;\\n    margin: 0 auto;\\n    background-image: url(/img/btn_back.png);\\n    color: transparent;\\n\"]);\n\n  _templateObject14 = function _templateObject14() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject13() {\n  var data = _taggedTemplateLiteral([\"\\n    display: block;\\n    margin: 0 auto 50px;\\n    width: 400px;\\n    height: 80px;\\n    background-image: url(/img/btn_confirm_help.png);\\n    color: transparent;\\n\"]);\n\n  _templateObject13 = function _templateObject13() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject12() {\n  var data = _taggedTemplateLiteral([\"\\n    width: 4em;\\n    margin: 80px auto;\\n    text-decoration: underline;\\n    font-size: 24px;\\n\"]);\n\n  _templateObject12 = function _templateObject12() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject11() {\n  var data = _taggedTemplateLiteral([\"\\n    display: none;\\n\"]);\n\n  _templateObject11 = function _templateObject11() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject10() {\n  var data = _taggedTemplateLiteral([\"\\n    display: block;\\n    width: 520px;\\n    height: 56px;\\n    text-align: center;\\n    line-height: 56px;\\n    background-color: #efefef;\\n    font-size: 18px;\\n    color: #9fa0a0;\\n\"]);\n\n  _templateObject10 = function _templateObject10() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject9() {\n  var data = _taggedTemplateLiteral([\"\\n    width: 520px;\\n    min-height: 320px;\\n    font-size: 18px;\\n    background-color: #efefef;\\n    padding: 17px 22px;\\n    box-sizing: border-box;\\n\"]);\n\n  _templateObject9 = function _templateObject9() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject8() {\n  var data = _taggedTemplateLiteral([\"\\n    width: 520px;\\n    height: 56px;\\n    font-size: 18px;\\n    background-color: #efefef;\\n    text-indent: 1em;\\n\"]);\n\n  _templateObject8 = function _templateObject8() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject7() {\n  var data = _taggedTemplateLiteral([\"\\n    display: block;\\n    margin-bottom: 0.5em;\\n    font-size: 22px;\\n\"]);\n\n  _templateObject7 = function _templateObject7() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject6() {\n  var data = _taggedTemplateLiteral([\"\"]);\n\n  _templateObject6 = function _templateObject6() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject5() {\n  var data = _taggedTemplateLiteral([\"\\n    margin-bottom: 50px;\\n\"]);\n\n  _templateObject5 = function _templateObject5() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject4() {\n  var data = _taggedTemplateLiteral([\"\\n    margin-bottom: 50px;\\n\"]);\n\n  _templateObject4 = function _templateObject4() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject3() {\n  var data = _taggedTemplateLiteral([\"\\n    position: relative;\\n    margin-bottom: 45px;\\n    padding-bottom: 33px;\\n    font-size: 38px;\\n    text-align: center;\\n    color: #000;\\n    &::before {\\n        content: '';\\n        position: absolute;\\n        left: 50%;\\n        bottom: 0;\\n        width: 100px;\\n        height: 5px;\\n        background-image: linear-gradient(to left, #00b4ed, #0091db);\\n        transform: translateX(-50%);\\n    }\\n\"]);\n\n  _templateObject3 = function _templateObject3() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject2() {\n  var data = _taggedTemplateLiteral([\"\\n    width: 600px;\\n    height: 950px;\\n    margin: 60px auto 0;\\n    padding: 75px 40px 102px;\\n    background-color: #fff;\\n    border-radius: 16px;\\n    box-sizing: border-box;\\n    overflow: hidden;\\n\"]);\n\n  _templateObject2 = function _templateObject2() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject() {\n  var data = _taggedTemplateLiteral([\"\\n    padding-bottom: 100px;\\n\"]);\n\n  _templateObject = function _templateObject() {\n    return data;\n  };\n\n  return data;\n}\n\nimport * as React from 'react';\nimport styled from '@emotion/styled';\nimport useForm from 'react-hook-form';\nimport { DateTime } from 'luxon';\nimport Main from \"../layouts/Main\";\nimport firebaseApp from \"../../../assets/utils/firebaseApp\";\nimport { COLLECTIONS, STRAGE_BACKET } from \"../../../assets/constant\";\nimport Tab from \"../../organisms/tab\";\nimport Confirm from \"../../organisms/register/confirm\";\nimport Result from \"../../organisms/register/result\";\n\nvar Register = function Register() {\n  var db = firebaseApp.firestore();\n  var storage = firebaseApp.storage(STRAGE_BACKET);\n  var storageRef = storage.ref();\n\n  var _useForm = useForm(),\n      register = _useForm.register,\n      handleSubmit = _useForm.handleSubmit,\n      errors = _useForm.errors; // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n\n  var _React$useState = React.useState(null),\n      _React$useState2 = _slicedToArray(_React$useState, 2),\n      currentFormData = _React$useState2[0],\n      setCurrentFormData = _React$useState2[1];\n\n  var _React$useState3 = React.useState(null),\n      _React$useState4 = _slicedToArray(_React$useState3, 2),\n      time = _React$useState4[0],\n      setTime = _React$useState4[1];\n\n  var _React$useState5 = React.useState(null),\n      _React$useState6 = _slicedToArray(_React$useState5, 2),\n      currentImgSrc = _React$useState6[0],\n      setCurrentImgSrc = _React$useState6[1];\n\n  var _React$useState7 = React.useState(''),\n      _React$useState8 = _slicedToArray(_React$useState7, 2),\n      postUrl = _React$useState8[0],\n      setPostUrl = _React$useState8[1];\n\n  var onRegister = function onRegister(data) {\n    console.log('send', data);\n    setCurrentFormData(data);\n    var now = DateTime.local().toString();\n    setTime(now);\n  };\n\n  React.useEffect(function () {\n    if (!currentFormData) return;\n    var fileList = currentFormData.image;\n    var file = fileList[0];\n    if (!['image/jpeg', 'image/png'].includes(file.type)) throw new Error('画像形式がサポートされていません');\n    var reader = new FileReader();\n\n    reader.onload = function (e) {\n      return setCurrentImgSrc(e.target.result);\n    };\n\n    reader.readAsDataURL(file);\n  }, [currentFormData]);\n  var onSubmit = React.useCallback(\n  /*#__PURE__*/\n  _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee() {\n    var _currentFormData$desc;\n\n    var fileList, file, imageRef, snapshot, postData;\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            if (currentFormData && time) {\n              _context.next = 2;\n              break;\n            }\n\n            return _context.abrupt(\"return\");\n\n          case 2:\n            fileList = currentFormData.image;\n            file = fileList[0];\n\n            if (['image/jpeg', 'image/png'].includes(file.type)) {\n              _context.next = 6;\n              break;\n            }\n\n            throw new Error('画像形式がサポートされていません');\n\n          case 6:\n            imageRef = storageRef.child(\"images/\".concat(file.name.split('.')[0], \"_\").concat(_Date$now(), \".jpg\"));\n            _context.next = 9;\n            return imageRef.put(file);\n\n          case 9:\n            snapshot = _context.sent;\n            postData = {\n              userId: 1,\n              title: currentFormData.title,\n              description: (_currentFormData$desc = currentFormData.description) !== null && _currentFormData$desc !== void 0 ? _currentFormData$desc : '',\n              isOpen: true,\n              createDate: time,\n              updateDate: time,\n              url: 'google.com',\n              imageUrl: \"\".concat(snapshot.metadata.fullPath),\n              side: 'help'\n            };\n            _context.next = 13;\n            return db.collection(COLLECTIONS.POSTS).add(postData).then(function (docRef) {\n              console.log('Document written with ID: ', docRef.id);\n            })[\"catch\"](function (error) {\n              console.error(error);\n            });\n\n          case 13:\n            // TODO シェアURL\n            setPostUrl('google.com');\n\n          case 14:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  })), [currentFormData, db, storageRef, time]);\n  return __jsx(Main, null, __jsx(Tab, {\n    leftContent: __jsx(Wrapper, null, !postUrl ? !(currentFormData && currentImgSrc && time) ? __jsx(\"form\", {\n      onSubmit: handleSubmit(onRegister)\n    }, __jsx(FormBox, null, __jsx(Title, null, \"\\u52DF\\u96C6\\u3092\\u4F5C\\u308B\"), __jsx(FormTitle, null, __jsx(TitleLabel, {\n      htmlFor: \"title\"\n    }, \"\\u984C\\u540D\"), __jsx(InputText, {\n      type: \"text\",\n      id: \"title\",\n      name: \"title\",\n      placeholder: \"\\u52DF\\u96C6\\u3057\\u305F\\u3044\\u3053\\u3068\\u3092\\u66F8\\u3044\\u3066\\u304F\\u3060\\u3055\\u3044\",\n      ref: register({\n        required: true\n      })\n    }), errors.title && __jsx(\"span\", null, \"This field is required\")), __jsx(FormDescription, null, __jsx(TitleLabel, {\n      htmlFor: \"description\"\n    }, \"\\u5185\\u5BB9\"), __jsx(TextArea, {\n      id: \"description\",\n      name: \"description\",\n      placeholder: \"\\u8A73\\u7D30\\u5185\\u5BB9\\u3092\\u66F8\\u3044\\u3066\\u304F\\u3060\\u3055\\u3044\",\n      ref: register\n    })), __jsx(FormImage, null, __jsx(TitleLabel, {\n      htmlFor: \"image\"\n    }, \"\\u5199\\u771F\\u30A2\\u30C3\\u30D7\\u30ED\\u30FC\\u30C9\"), __jsx(ImageLabelBox, {\n      htmlFor: \"image\"\n    }, \"\\u30D5\\u30A1\\u30A4\\u30EB\\u3092\\u9078\\u629E\"), __jsx(InputImage, {\n      type: \"file\",\n      id: \"image\",\n      name: \"image\",\n      ref: register({\n        required: true\n      })\n    }))), __jsx(Howto, null, \"\\u4F7F\\u3044\\u304B\\u305F\"), __jsx(ConfirmButton, {\n      type: \"submit\"\n    }, \"\\u9001\\u4FE1\"), __jsx(BackButton, null, \"\\u623B\\u308B\")) : __jsx(Confirm, {\n      title: currentFormData.title,\n      description: currentFormData.description,\n      imgUrl: currentImgSrc,\n      updateDate: time,\n      onSubmit: onSubmit\n    }) : __jsx(Result, {\n      url: postUrl\n    }))\n  }));\n};\n\nexport default Register;\nvar Wrapper = styled.div(_templateObject());\nvar FormBox = styled.div(_templateObject2());\nvar Title = styled.h1(_templateObject3());\nvar FormTitle = styled.div(_templateObject4());\nvar FormDescription = styled.div(_templateObject5());\nvar FormImage = styled.div(_templateObject6());\nvar TitleLabel = styled.label(_templateObject7());\nvar InputText = styled.input(_templateObject8());\nvar TextArea = styled.textarea(_templateObject9());\nvar ImageLabelBox = styled.label(_templateObject10());\nvar InputImage = styled.input(_templateObject11());\nvar Howto = styled.p(_templateObject12());\nvar ConfirmButton = styled.button(_templateObject13());\nvar BackButton = styled.button(_templateObject14());","map":null,"metadata":{},"sourceType":"module"}